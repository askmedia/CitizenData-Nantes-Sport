"use strict";function key(t){return t.data.federation}function type(t){return t}function findNeighborArc(t,e,n,r){var a;return(a=findPreceding(t,e,n,r))?{startAngle:a.endAngle,endAngle:a.endAngle}:(a=findFollowing(t,e,n,r))?{startAngle:a.startAngle,endAngle:a.startAngle}:null}function findPreceding(t,e,n,r){for(var a=e.length;--t>=0;)for(var i=r(n[t]),o=0;a>o;++o)if(r(e[o])===i)return e[o]}function findFollowing(t,e,n,r){for(var a=n.length,i=e.length;++t<a;)for(var o=r(n[t]),c=0;i>c;++c)if(r(e[c])===o)return e[c]}function arcTween(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return arc(e(t))}}var $container=jQuery(".graph-container"),$labelTitle=jQuery(".graph__body__title span"),width=$container.width(),height=$container.height(),radius=Math.min(width,height)/2,innerRadius=65,color=d3.scale.category20(),pie=d3.layout.pie().startAngle(0).sort(null).value(function(t){return 1}),svg=d3.select("#graph").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")"),path=svg.selectAll("path"),min,max,arc,tip=d3.tip().attr("class","d3-tip").html(function(t){return t});d3.csv("nantes.csv",type,function(t,e){function n(){var t=d3.select(".sex:checked").attr("value"),e=d3.select(".age:checked").attr("value");console.log(t+"-"+e),console.log(jQuery("#"+t+"-"+e)),jQuery("#"+t+"-"+e).click()}function r(t){console.log(t);var e=path.data(),n=pie(t.values);path=path.data(n,key),path.enter().append("path").each(function(t,r){this._current=findNeighborArc(r,e,n,key)||t}).attr("class","arc").attr("fill","#aaced3").append("title").on("mouseover",function(t){console.log(t),$labelTitle.text(t)}).on("mouseout",function(){}).text(function(t){return t.data.federation}),path.exit().datum(function(t,r){return findNeighborArc(r,n,e,key)||t}).transition().duration(750).attrTween("d",arcTween).remove(),path.transition().duration(750).attrTween("d",arcTween)}max=d3.max(e,function(t){return parseInt(t.ratio,10)}),min=d3.min(e,function(t){return parseInt(t.ratio,10)});var a=d3.scale.sqrt().domain([min,max]).range([innerRadius,radius]);arc=d3.svg.arc().outerRadius(function(t){return a(t.data.ratio)}).innerRadius(innerRadius);var i=d3.nest().key(function(t){return t.sex+"-"+t.age}).entries(e),o=d3.nest().key(function(t){return t.sex}).entries(e),c=d3.nest().key(function(t){return t.age}).entries(e),u=d3.select("#all").selectAll("label").data(i).enter().append("label");u.append("input").attr("type","radio").attr("name","all").attr("value",function(t){return t.key}).attr("id",function(t){return t.key}).on("change",r).filter(function(t,e){return e}).property("checked",!0),u.append("span").text(function(t){return t.key}),jQuery("#sexes input, #ages input").on("click",function(){n(),jQuery(this).closest(".filter").find(".filter-item").hasClass("active")&&jQuery(this).closest(".filter").find(".filter-item").removeClass("active"),jQuery(this).closest("li").addClass("active")}),n()});