"use strict";function key(e){return e.data.federation}function type(e){return e}function findNeighborArc(e,t,n,r){var a;return(a=findPreceding(e,t,n,r))?{startAngle:a.endAngle,endAngle:a.endAngle}:(a=findFollowing(e,t,n,r))?{startAngle:a.startAngle,endAngle:a.startAngle}:null}function findPreceding(e,t,n,r){for(var a=t.length;--e>=0;)for(var i=r(n[e]),l=0;a>l;++l)if(r(t[l])===i)return t[l]}function findFollowing(e,t,n,r){for(var a=n.length,i=t.length;++e<a;)for(var l=r(n[e]),o=0;i>o;++o)if(r(t[o])===l)return t[o]}function arcTween(e){var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){return arc(t(e))}}jQuery(function(){jQuery(".share-item a").on("click",function(e){return console.log(this),window.open(jQuery(this).attr("href"),"share","menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,innerWidth=600,innerHeight=400"),e.preventDefault(),!1})});var $container=jQuery(".graph-container"),$label=jQuery("#graph__body div"),$labelTitle=jQuery(".graph__body__title span"),$labelNumber=jQuery(".graph__body__number"),$defaultMessage=jQuery("#default-message"),titles={101:"Athlétisme",102:"Aviron",103:"Badmington",105:"Basketball",109:"Equitation",111:"Football",113:"Gymnastique",115:"Handball",117:"Judo, Jujitsu",119:"Natation",123:"Tennis",124:"Tennis de table",128:"Voile",132:"Golf",245:"Randonnée",246:"Roller"},margin=100,width=$container.width()-margin,height=$container.height()-margin,radius=Math.min(width,height)/2,innerRadius=65;jQuery("#graph").css("padding",margin/2+"px");var color=d3.scale.category20(),pie=d3.layout.pie().startAngle(0).sort(null).value(function(e){return 1}),svg=d3.select("#graph").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")"),path=svg.selectAll("path"),min,max,arc,tip=d3.tip().attr("class","d3-tip").html(function(e){return e});d3.csv("nantes.csv",type,function(e,t){function n(){var e=d3.select(".sex:checked").attr("value"),t=d3.select(".age:checked").attr("value");console.log(e+"-"+t),console.log(jQuery("#"+e+"-"+t)),jQuery("#"+e+"-"+t).click()}function r(e){console.log(e);var t=path.data(),n=pie(e.values);path=path.data(n,key),path.enter().append("path").each(function(e,r){this._current=findNeighborArc(r,t,n,key)||e}).attr("class","arc").attr("fill","#aaced3").on("mouseenter",function(e){$defaultMessage.css("display","none"),$labelTitle.text(titles[e.data.fed_2012]),$labelNumber.text(e.data.licences),$label.show()}).on("mouseleave",function(){$label.hide(),$defaultMessage.css("display","table-cell")}).append("title").text(function(e){return e.data.federation}),path.exit().datum(function(e,r){return findNeighborArc(r,n,t,key)||e}).transition().duration(750).attrTween("d",arcTween).remove(),path.transition().duration(750).attrTween("d",arcTween)}max=d3.max(t,function(e){return parseInt(e.ratio,10)}),min=d3.min(t,function(e){return parseInt(e.ratio,10)});var a=d3.scale.sqrt().domain([min,max]).range([innerRadius,radius]);arc=d3.svg.arc().outerRadius(function(e){return a(e.data.ratio)}).innerRadius(innerRadius);var i=d3.nest().key(function(e){return e.sex+"-"+e.age}).entries(t);console.log(d3.nest().key(function(e){return e.fed_2012+"-"+e.federation}).entries(t));var l=d3.nest().key(function(e){return e.sex}).entries(t),o=d3.nest().key(function(e){return e.age}).entries(t),u=d3.select("#all").selectAll("label").data(i).enter().append("label");u.append("input").attr("type","radio").attr("name","all").attr("value",function(e){return e.key}).attr("id",function(e){return e.key}).on("change",r).filter(function(e,t){return t}).property("checked",!0),u.append("span").text(function(e){return e.key}),jQuery("#sexes input, #ages input").on("click",function(){n()}),n()}),jQuery(".bt-explore").on("click",function(){jQuery(".wrapper__intro").fadeOut("slow",function(){jQuery(".wrapper-block, .sources").fadeIn("slow")})});