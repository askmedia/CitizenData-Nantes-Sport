jQuery(window).ready(function(){function t(t){return t.data.federation}function e(t){return t}function n(t,e,n,i){var o;return(o=a(t,e,n,i))?{startAngle:o.endAngle,endAngle:o.endAngle}:(o=r(t,e,n,i))?{startAngle:o.startAngle,endAngle:o.startAngle}:null}function a(t,e,n,a){for(var r=e.length;--t>=0;)for(var i=a(n[t]),o=0;r>o;++o)if(a(e[o])===i)return e[o]}function r(t,e,n,a){for(var r=n.length,i=e.length;++t<r;)for(var o=a(n[t]),u=0;i>u;++u)if(a(e[u])===o)return e[u]}function i(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return w(e(t))}}function o(t){jQuery(".sport-icon").removeClass("hover"),jQuery(".sport-id-"+t.data.fed_2012).addClass("hover"),c.css("display","none"),s.text(f[t.data.fed_2012]),l.text(Math.round(t.data.ratio)),d.show()}function u(){jQuery(".sport-icon").removeClass("hover"),d.hide(),c.css("display","table-cell")}if(syze.sizes(768,992),!jQuery("html").hasClass("lt992")){console.log("D3"),jQuery(function(){jQuery(".share-item a").on("click",function(t){var e=575,n=400,a=($(window).width()-e)/2,r=($(window).height()-n)/2,i=jQuery(this).attr("href"),o="status=1,width="+e+",height="+n+",top="+r+",left="+a;return window.open(i,"share",o),t.preventDefault(),!1})});var d=jQuery("#graph__body div"),s=jQuery(".graph__body__title span"),l=jQuery(".graph__body__number"),c=jQuery("#default-message"),f={101:"Athlétisme",102:"Aviron",103:"Badminton",105:"Basketball",109:"Equitation",111:"Football",113:"Gymnastique",115:"Handball",117:"Judo, Jujitsu",119:"Natation",123:"Tennis",124:"Tennis de table",128:"Voile",132:"Golf",245:"Randonnée",246:"Roller"},p=100,h=225,y=65;jQuery("#graph").css("padding",p/2+"px");var v=0,g=d3.layout.pie().startAngle(v*(Math.PI/180)).sort(null).value(function(){return 1}),j=d3.select("#graph").append("svg").append("g").attr("transform","translate(225,225)"),Q=j.selectAll("path"),m,_,w;jQuery(".sport-icon").hover(function(){jQuery(".arc").attr("fill","#aaced3"),jQuery(".arc-id-"+jQuery(this).data("id")).attr("fill","#000");var t=d3.select(".arc-id-"+jQuery(this).data("id")).data()[0];console.log(t),c.css("display","none"),s.text(f[t.data.fed_2012]),l.text(Math.round(t.data.ratio)),d.show()},function(){jQuery(".arc").attr("fill","#aaced3"),u()}),d3.csv("nantes.csv",e,function(e,a){function r(){var t=d3.select(".sex:checked").attr("value"),e=d3.select(".age:checked").attr("value");jQuery("#"+t+"-"+e).click()}function d(e){u();var a=Q.data(),r=g(e.values);Q=Q.data(r,t),Q.enter().append("path").each(function(e,i){this._current=n(i,a,r,t)||e}).attr("class",function(t){return"arc arc-id-"+t.data.fed_2012}).attr("fill","#aaced3").on("mouseenter",o).on("touchstart",o).on("mouseleave",u).append("title").text(function(t){return t.data.federation}),Q.exit().datum(function(e,i){return n(i,r,a,t)||e}).transition().duration(750).attrTween("d",i).remove(),Q.transition().duration(750).attrTween("d",i)}_=d3.max(a,function(t){return parseInt(t.ratio,10)}),m=d3.min(a,function(t){return parseInt(t.ratio,10)});var s=d3.scale.sqrt().domain([m,_]).range([y,h]);w=d3.svg.arc().outerRadius(function(t){return s(t.data.ratio)}).innerRadius(y);var l=d3.nest().key(function(t){return t.sex+"-"+t.age}).entries(a),c=d3.select("#all").selectAll("label").data(l).enter().append("label");c.append("input").attr("type","radio").attr("name","all").attr("value",function(t){return t.key}).attr("id",function(t){return t.key}).on("change",d).filter(function(t,e){return e}).property("checked",!0),c.append("span").text(function(t){return t.key}),jQuery("#sexes input, #ages input").on("click",function(){r()}),r()})}});